<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The Community Distribution of Kubernetes that powers Red Hat OpenShift"><meta name=author content="Brian Innes"><link href=https://openshift-cs.github.io/okd.io/index.html/guides/virt-baremetal-upi/ rel=canonical><link rel=icon href=../../img/okdLogo.png><meta name=generator content="mkdocs-1.3.0, mkdocs-material-8.2.14"><title>OKD Virtualization - OKD.io</title><link rel=stylesheet href=../../assets/stylesheets/main.3de6f41f.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.cc9b2e1e.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Open Sans";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../css/extra.css><script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=okd data-md-color-primary=blue-grey data-md-color-accent=red> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#okd-virtualization-on-user-provided-infrastructure class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=OKD.io class="md-header__button md-logo" aria-label=OKD.io data-md-component=logo> <img src=../../img/okd_logo_resized.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> OKD.io </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> OKD Virtualization </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=okd data-md-color-primary=blue-grey data-md-color-accent=red aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=okd-dark data-md-color-primary=okd-blue data-md-color-accent=okd-light-green aria-label="Switch to light mode" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg> </label> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/openshift-cs/okd.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> okd-io </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=OKD.io class="md-nav__button md-logo" aria-label=OKD.io data-md-component=logo> <img src=../../img/okd_logo_resized.svg alt=logo> </a> OKD.io </label> <div class=md-nav__source> <a href=https://github.com/openshift-cs/okd.io title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.1.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> okd-io </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../../about/ class=md-nav__link> About </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3 checked> <label class=md-nav__link for=__nav_3> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../installation/ class=md-nav__link> Installation </a> </li> <li class=md-nav__item> <a href=../../crc/ class=md-nav__link> CRC </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_3 type=checkbox id=__nav_3_3 checked> <label class=md-nav__link for=__nav_3_3> Guides <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Guides data-md-level=2> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../automated-vsphere-upi/ class=md-nav__link> Automated vSphere install </a> </li> <li class=md-nav__item> <a href=../vsphere-prereqs/ class=md-nav__link> Prerequites for vSphere UPI </a> </li> <li class=md-nav__item> <a href=../vsphere-ipi/ class=md-nav__link> vSphere IPI Deployment </a> </li> <li class=md-nav__item> <a href=../sno/ class=md-nav__link> Single Node OKD Installation </a> </li> <li class=md-nav__item> <a href=../vadim/ class=md-nav__link> Vadim's homelab </a> </li> <li class=md-nav__item> <a href=../sri/ class=md-nav__link> Sri's homelab </a> </li> <li class=md-nav__item> <a href=../azure-ipi/ class=md-nav__link> Azure IPI Default Deployment </a> </li> <li class=md-nav__item> <a href=../aws-ipi/ class=md-nav__link> AWS IPI Default Deployment </a> </li> <li class=md-nav__item> <a href=../gcp-ipi/ class=md-nav__link> GCP IPI Default Deployment </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> OKD Virtualization <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> OKD Virtualization </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-the-hardware class=md-nav__link> Preparing the hardware </a> </li> <li class=md-nav__item> <a href=#preparing-the-infrastructure class=md-nav__link> Preparing the infrastructure </a> </li> <li class=md-nav__item> <a href=#provision-your-hosts class=md-nav__link> Provision your hosts </a> </li> <li class=md-nav__item> <a href=#configure-the-bastion-to-host-needed-services class=md-nav__link> Configure the bastion to host needed services </a> </li> <li class=md-nav__item> <a href=#installing-okd class=md-nav__link> Installing OKD </a> </li> <li class=md-nav__item> <a href=#apply-the-workarounds class=md-nav__link> Apply the workarounds </a> </li> <li class=md-nav__item> <a href=#installing-hco-and-kubevirt class=md-nav__link> Installing HCO and KubeVirt </a> </li> <li class=md-nav__item> <a href=#providing-storage class=md-nav__link> Providing storage </a> <nav class=md-nav aria-label="Providing storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shared-storage class=md-nav__link> Shared storage </a> </li> <li class=md-nav__item> <a href=#local-storage class=md-nav__link> Local storage </a> <nav class=md-nav aria-label="Local storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes class=md-nav__link> Configuring SELinux for the hostpath provisioner on OKD worker nodes </a> </li> <li class=md-nav__item> <a href=#creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator class=md-nav__link> Creating a custom resource (CR) for the HostPathProvisioner operator </a> </li> <li class=md-nav__item> <a href=#creating-a-storageclass-for-the-hostpathprovisioner-operator class=md-nav__link> Creating a StorageClass for the HostPathProvisioner operator </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../docs/ class=md-nav__link> Documentation </a> </li> <li class=md-nav__item> <a href=../../blog/ class=md-nav__link> Blog </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_6 type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6> Community <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Community data-md-level=1> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../community/ class=md-nav__link> OKD Community </a> </li> <li class=md-nav__item> <a href=../../conduct/ class=md-nav__link> Code of Conduct </a> </li> <li class=md-nav__item> <a href=../../contributor/ class=md-nav__link> Contributor </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> OKD Working Group <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="OKD Working Group" data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> OKD Working Group </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../working-groups/ class=md-nav__link> About </a> </li> <li class=md-nav__item> <a href=../../charter/ class=md-nav__link> Charter </a> </li> <li class=md-nav__item> <a href=../../working-group/minutes/minutes/ class=md-nav__link> Minutes </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4 type=checkbox id=__nav_7_4> <label class=md-nav__link for=__nav_7_4> Subgroups <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Subgroups data-md-level=2> <label class=md-nav__title for=__nav_7_4> <span class="md-nav__icon md-icon"></span> Subgroups </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4_1 type=checkbox id=__nav_7_4_1> <label class=md-nav__link for=__nav_7_4_1> Documentation <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Documentation data-md-level=3> <label class=md-nav__title for=__nav_7_4_1> <span class="md-nav__icon md-icon"></span> Documentation </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../wg_docs/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../wg_docs/okd-io/ class=md-nav__link> Modifying OKD.io </a> </li> <li class=md-nav__item> <a href=../../wg_docs/doc-env/ class=md-nav__link> Setup environment </a> </li> <li class=md-nav__item> <a href=../../wg_docs/content/ class=md-nav__link> Content guidelines </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4_2 type=checkbox id=__nav_7_4_2> <label class=md-nav__link for=__nav_7_4_2> CRC Build <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="CRC Build" data-md-level=3> <label class=md-nav__title for=__nav_7_4_2> <span class="md-nav__icon md-icon"></span> CRC Build </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../wg_crc/overview/ class=md-nav__link> Overview </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7_4_3 type=checkbox id=__nav_7_4_3> <label class=md-nav__link for=__nav_7_4_3> OKD Virtualization <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="OKD Virtualization" data-md-level=3> <label class=md-nav__title for=__nav_7_4_3> <span class="md-nav__icon md-icon"></span> OKD Virtualization </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../wg_virt/overview/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../wg_virt/community/ class=md-nav__link> Community </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_8 type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8> OKD Development <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="OKD Development" data-md-level=1> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> OKD Development </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../okd_tech_docs/ class=md-nav__link> Overview </a> </li> <li class=md-nav__item> <a href=../../okd_tech_docs/modifying_okd/ class=md-nav__link> Modifying OKD </a> </li> <li class=md-nav__item> <a href=../../okd_tech_docs/operators/ class=md-nav__link> Operator Hub catalogs </a> </li> <li class=md-nav__item> <a href=../../okd_tech_docs/release/ class=md-nav__link> Release </a> </li> <li class=md-nav__item> <a href=../../okd_tech_docs/troubleshoot/ class=md-nav__link> Troubleshooting </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_9 type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9> Help <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Help data-md-level=1> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Help </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../help/ class=md-nav__link> Getting Help </a> </li> <li class=md-nav__item> <a href=../../faq/ class=md-nav__link> FAQ </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#preparing-the-hardware class=md-nav__link> Preparing the hardware </a> </li> <li class=md-nav__item> <a href=#preparing-the-infrastructure class=md-nav__link> Preparing the infrastructure </a> </li> <li class=md-nav__item> <a href=#provision-your-hosts class=md-nav__link> Provision your hosts </a> </li> <li class=md-nav__item> <a href=#configure-the-bastion-to-host-needed-services class=md-nav__link> Configure the bastion to host needed services </a> </li> <li class=md-nav__item> <a href=#installing-okd class=md-nav__link> Installing OKD </a> </li> <li class=md-nav__item> <a href=#apply-the-workarounds class=md-nav__link> Apply the workarounds </a> </li> <li class=md-nav__item> <a href=#installing-hco-and-kubevirt class=md-nav__link> Installing HCO and KubeVirt </a> </li> <li class=md-nav__item> <a href=#providing-storage class=md-nav__link> Providing storage </a> <nav class=md-nav aria-label="Providing storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#shared-storage class=md-nav__link> Shared storage </a> </li> <li class=md-nav__item> <a href=#local-storage class=md-nav__link> Local storage </a> <nav class=md-nav aria-label="Local storage"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes class=md-nav__link> Configuring SELinux for the hostpath provisioner on OKD worker nodes </a> </li> <li class=md-nav__item> <a href=#creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator class=md-nav__link> Creating a custom resource (CR) for the HostPathProvisioner operator </a> </li> <li class=md-nav__item> <a href=#creating-a-storageclass-for-the-hostpathprovisioner-operator class=md-nav__link> Creating a StorageClass for the HostPathProvisioner operator </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <a href=https://github.com/openshift-cs/okd.io/edit/main/docs/guides/virt-baremetal-upi/index.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg> </a> <h1 id=okd-virtualization-on-user-provided-infrastructure>OKD Virtualization on user provided infrastructure<a class=headerlink href=#okd-virtualization-on-user-provided-infrastructure title="Permanent link">&para;</a></h1> <!--- cSpell:ignore baremetal rpcbind openvswitch kube Virt Hyperconverged hostpath machineconfig kubevirt --> <h2 id=preparing-the-hardware>Preparing the hardware<a class=headerlink href=#preparing-the-hardware title="Permanent link">&para;</a></h2> <p>As a first step for providing an infrastructure for OKD Virtualization, you need to prepare the hardware:</p> <ul> <li>check that the <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#minimum-resource-requirements_installing-bare-metal>minimum hardware requirements for running OKD</a> are satisfied</li> <li>check that the <a href=https://docs.okd.io/latest/virt/install/preparing-cluster-for-virt.html#virt-cluster-resource-requirements_preparing-cluster-for-virt>additional hardware requirements for running OKD Virtualization</a> are also satisfied.</li> </ul> <h2 id=preparing-the-infrastructure>Preparing the infrastructure<a class=headerlink href=#preparing-the-infrastructure title="Permanent link">&para;</a></h2> <p>Once your hardware is ready and connected to the network you need to configure your services, your network and your DNS for allowing the OKD installer to deploy the software. You may also need to prepare in advance a few services you'll need during the deployment. Carefully read the <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#installation-infrastructure-user-infra_installing-bare-metal>Preparing the user-provisioned infrastructure</a> section and ensure all the requirements are met.</p> <h2 id=provision-your-hosts>Provision your hosts<a class=headerlink href=#provision-your-hosts title="Permanent link">&para;</a></h2> <p>For the bastion / service host you can use CentOS Stream 8. You can follow the <a href=https://docs.centos.org/en-US/8-docs/standard-install/ >CentOS 8 installation documentation</a> but we recommend using the latest <a href=http://isoredirect.centos.org/centos/8-stream/isos/x86_64/ >CentOS Stream 8 ISO</a>.</p> <p>For the OKD nodes you’ll need Fedora CoreOS. You can get it from the <a href="https://getfedora.org/en/coreos?stream=stable">Get Fedora!</a> website, choose the Bare Metal ISO.</p> <h2 id=configure-the-bastion-to-host-needed-services>Configure the bastion to host needed services<a class=headerlink href=#configure-the-bastion-to-host-needed-services title="Permanent link">&para;</a></h2> <p>Configure Apache to serve on port 8080/8443 as the http/https port will be used by the haproxy service. Apache will be needed to provide ignition configuration for OKD nodes.</p> <div class=highlight><pre><span></span><code>dnf install -y httpd
sed -i <span class=s1>&#39;s/Listen 80/Listen 8080/&#39;</span> /etc/httpd/conf/httpd.conf
sed -i <span class=s1>&#39;s/Listen 443/Listen 8443/&#39;</span> /etc/httpd/conf.d/ssl.conf
setsebool -P httpd_read_user_content <span class=m>1</span>
systemctl <span class=nb>enable</span> --now httpd.service
firewall-cmd --permanent --add-port<span class=o>=</span><span class=m>8080</span>/tcp
firewall-cmd --permanent --add-port<span class=o>=</span><span class=m>8443</span>/tcp
firewall-cmd --reload
<span class=c1># Verify it’s up:</span>
curl localhost:8080
</code></pre></div> <p>Configure haproxy:</p> <div class=highlight><pre><span></span><code>dnf install haproxy -y
firewall-cmd --permanent --add-port<span class=o>=</span><span class=m>6443</span>/tcp
firewall-cmd --permanent --add-port<span class=o>=</span><span class=m>22623</span>/tcp
firewall-cmd --permanent --add-service<span class=o>=</span>http
firewall-cmd --permanent --add-service<span class=o>=</span>https
firewall-cmd --reload
setsebool -P haproxy_connect_any <span class=m>1</span>
systemctl <span class=nb>enable</span> --now haproxy.service
</code></pre></div> <h2 id=installing-okd>Installing OKD<a class=headerlink href=#installing-okd title="Permanent link">&para;</a></h2> <p>OKD current stable-4 branch is delivering OKD 4.8. If you're using an older version we recommend to update to ODK 4.8.</p> <p>At this point you should have all OKD nodes ready to be installed with Fedora CoreOS and the bastion with all the needed services. Check that all nodes and the bastion have the correct ip addresses and fqdn and that they are resolvable via DNS.</p> <p>As we are going to use the baremetal UPI installation you’ll need to create a <code>install-config.yaml</code> following the example for <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#installation-bare-metal-config-yaml_installing-bare-metal>installing bare metal</a></p> <p>Remember to <a href=https://docs.okd.io/latest/installing/installing_bare_metal/installing-bare-metal.html#installation-configure-proxy_installing-bare-metal>configure your proxy settings if you have a proxy</a></p> <h2 id=apply-the-workarounds>Apply the workarounds<a class=headerlink href=#apply-the-workarounds title="Permanent link">&para;</a></h2> <ul> <li>qemu-ga is hitting selinux denials <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1927639">https://bugzilla.redhat.com/show_bug.cgi?id=1927639</a></li> </ul> <p>You can workaround this by adding a custom policy: <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=s1>&#39;(allow virt_qemu_ga_t container_var_lib_t (dir (search)))&#39;</span> &gt;local_virtqemu_ga.cil
semodule -i local_virtqemu_ga.cil
</code></pre></div></p> <ul> <li>iptables is hitting selinux denials <a href="https://bugzilla.redhat.com/show_bug.cgi?id=2008097">https://bugzilla.redhat.com/show_bug.cgi?id=2008097</a></li> </ul> <p>You can workaround this by adding a custom policy:</p> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=s1>&#39;(allow iptables_t cgroup_t (dir (ioctl)))&#39;</span> &gt;local_iptables.cil
semodule -i local_iptables.cil
</code></pre></div> <ul> <li>rpcbind</li> </ul> <div class=highlight><pre><span></span><code><span class=nb>echo</span> <span class=s1>&#39;(allow rpcbind_t unreserved_port_t (udp_socket (name_bind)))&#39;</span> &gt;local_rpcbind.cil
semodule -i local_rpcbind.cil
</code></pre></div> <ul> <li>master nodes are failing the first boot with access denied to <code>[::1]:53</code> <a href=https://github.com/openshift/okd/issues/897>https://github.com/openshift/okd/issues/897</a></li> </ul> <p>While the master node is booting edit the grub config adding to kernel command line <code>console=null</code>.</p> <ul> <li>worker nodes may fail on openvswitch</li> </ul> <div class=highlight><pre><span></span><code>echo &#39;(allow openvswitch_t init_var_run_t (capability (fsetid)))&#39; &gt;local_openvswitch.cil
semodule -i local_openvswitch.cil
</code></pre></div> <h2 id=installing-hco-and-kubevirt>Installing HCO and KubeVirt<a class=headerlink href=#installing-hco-and-kubevirt title="Permanent link">&para;</a></h2> <p>Once the OKD console is up, connect to it. Go to <strong>Operators</strong> -&gt; <strong>OperatorHub</strong>, look for <code>KubeVirt HyperConverged Cluster Operator</code> and install it.</p> <p>Click on the <strong>Create Hyperconverged</strong> button, all the defaults should be fine.</p> <h2 id=providing-storage>Providing storage<a class=headerlink href=#providing-storage title="Permanent link">&para;</a></h2> <p>Shared storage is not mandatory for OKD Virtualization, but without a doubt it provides many advantages over a configuration based on local storage which is considered a suboptimal configuration.</p> <p>Between the advantages enabled by shared storage it is worth mentioning: - Live migration of Virtual Machines - Founding pillar for HA - Enables seamless cluster upgrades without the need to shut down and restart all the VMs on each upgrade - Centralized storage management enabling elastic scalability - Centralized backup</p> <h3 id=shared-storage>Shared storage<a class=headerlink href=#shared-storage title="Permanent link">&para;</a></h3> <p>TBD: rook.io deployment</p> <h3 id=local-storage>Local storage<a class=headerlink href=#local-storage title="Permanent link">&para;</a></h3> <p>You can configure local storage for your virtual machines by using the OKD Virtualization hostpath provisioner feature.</p> <p>When you install OKD Virtualization, the hostpath provisioner Operator is automatically installed. To use it, you must: - Configure SELinux on your worker nodes via a Machine Config object. - Create a HostPathProvisioner custom resource. - Create a StorageClass object for the hostpath provisioner.</p> <h4 id=configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes>Configuring SELinux for the hostpath provisioner on OKD worker nodes<a class=headerlink href=#configuring-selinux-for-the-hostpath-provisioner-on-okd-worker-nodes title="Permanent link">&para;</a></h4> <p>You can configure SELinux for your OKD Worker nodes using a <a href=contrib/machineconfig-selinux-hpp.yaml>MachineConfig</a>.</p> <h4 id=creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator>Creating a custom resource (CR) for the HostPathProvisioner operator<a class=headerlink href=#creating-a-custom-resource-cr-for-the-hostpathprovisioner-operator title="Permanent link">&para;</a></h4> <ol> <li> <p>Create the HostPathProvisioner custom resource file. For example:</p> <div class=highlight><pre><span></span><code>$ touch hostpathprovisioner_cr.yaml
</code></pre></div> </li> <li> <p>Edit that file. For example:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostpathprovisioner.kubevirt.io/v1beta1</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">HostPathProvisioner</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-provisioner</span><span class=w></span>
<span class=nt>spec</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">IfNotPresent</span><span class=w></span>
<span class=w>  </span><span class=nt>pathConfig</span><span class=p>:</span><span class=w></span>
<span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s>&quot;/var/hpvolumes&quot;</span><span class=w> </span><span class=c1># The path of the directory on the node</span><span class=w></span>
<span class=w>    </span><span class=nt>useNamingPrefix</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class=w> </span><span class=c1># Use the name of the PVC bound to the created PV as part of the directory name.</span><span class=w></span>
</code></pre></div> </li> <li> <p>Create the CR in the <code>kubevirt-hyperconverged</code> namespace:</p> <div class=highlight><pre><span></span><code>$ oc create -n kubevirt-hyperconverged -f hostpathprovisioner_cr.yaml
</code></pre></div> </li> </ol> <h4 id=creating-a-storageclass-for-the-hostpathprovisioner-operator>Creating a StorageClass for the HostPathProvisioner operator<a class=headerlink href=#creating-a-storageclass-for-the-hostpathprovisioner-operator title="Permanent link">&para;</a></h4> <ol> <li> <p>Create the YAML file for the storage class. For example:</p> <div class=highlight><pre><span></span><code>$ touch hppstorageclass.yaml
</code></pre></div> </li> <li> <p>Edit that file. For example:</p> <div class=highlight><pre><span></span><code><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span><span class=w></span>
<span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span><span class=w></span>
<span class=nt>metadata</span><span class=p>:</span><span class=w></span>
<span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">hostpath-provisioner</span><span class=w></span>
<span class=nt>provisioner</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">kubevirt.io/hostpath-provisioner</span><span class=w></span>
<span class=nt>reclaimPolicy</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Delete</span><span class=w></span>
<span class=nt>volumeBindingMode</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">WaitForFirstConsumer</span><span class=w></span>
</code></pre></div> </li> <li> <p>Creating the Storage Class object:</p> <div class=highlight><pre><span></span><code>$ oc create -f hppstorageclass.yaml
</code></pre></div> </li> </ol> </article> </div> </div> </main> <!-- Footer --> <footer class=md-footer> <div class=container> <div class=row> <!-- Social Section --> <div class="col-md-4 col-sm-12"> <a href=https://www.redhat.com/ > <img alt="Red Hat" src=https://assets.openshift.com/hubfs/images/logos/Logo-RedHat-A-Reverse-RGB.svg style="width: 128px"> </a> </div> <div class="col-md-4 col-sm-12"> <ul class=social> <li class=twitter> <a href=https://twitter.com/okd_io> <span> <i class="fa fa-twitter-square"></i> </span> </a> </li> <li class=github> <a href=https://github.com/openshift/okd> <span> <i class="fa fa-github"></i> </span> </a> </li> <li class=google> <a href=https://plus.google.com/communities/114361859072744017486> <span> <i class="fa fa-google-plus-square"></i> </span> </a> </li> <li class=facebook> <a href=https://www.facebook.com/openshift> <span> <i class="fa fa-facebook-square"></i> </span> </a> </li> </ul> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["content.code.annotate", "navigation.instant", "naviagation.sections", "navigation.tracking", "search.suggest", "search.highlight"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script> <script src=../../assets/javascripts/bundle.c2e1ee47.min.js></script> </body> </html>